---
title: github copilotでの「負の遺産」解消
description: 
date: 2026-02-17T07:19:01.000Z
draft: true
tags:
  - github
  - copilot
categories:
  - Technology
---
# お断りの文

* 生成AIであまり仕事できてないかもです！
　が、とりあえず納品できたし、綿密に計画してそのとおりに実装できたから(๑ㅂ)و✧
* 優秀な方のためには書かれていないので「俺はできる！」という人はまず読まないほうがいいです。
* 誰にも教えてもらえない人が生成AIと仕事するとどうなるかを書いています。

# ゴリゴリのレガシーコードと戦う（今年の仕事)

* 無駄に年齢を重ねてきたので酷いコードと付き合うのは宿命です。
* PHP 7.2でとりあえず動く状態で10年近く放置されているコードがあります。
* PHP 5 以前からの<s>秘伝のタレ</s>で漬け込まれた腐の遺産
* test/stan なんですかそれ状態。 
* composerで 手をいれると真っ先に破綻しそうな過去ライブラリの山。

## と、とにかく分析しよう

* 昨年秋にそんな特級呪物の解析に入りました。
* 「php5.x 使えとかいう恐怖案件ではないので安心してください（嘘だ）」
* ややー　DBがおかしい。
* 「式年遷宮」するらしい（嘘ではない）
* .php ファイルが1000行超えて何十個もあります（わけわけんねえ）

## もはや人力では不可能。github copilot に

* roadmap.md を書いた　→　遠い目標
* DBを解析してもらうんだけど、チョット古いので開発環境では開けない
* さまよえるDB解析作業場（WindowsOS環境で開けられるからやってみる）
* copilot の使い方習熟中
* copilot Agent/Ask/Planの違いを理解していない→やたらコードができて困る（Agentでなんでも質問するのはだめ）

## 遺産の解消（の計画）

* SQLDBをわりと使いやすいものに入れ替え（バレそうなのであえて伏せる）
* PHP5.x/PHP7.x じゃなくても動くよ‐にした。PHP8.5でも行けるように
* セキュリティ対策は全然進まない。構造的問題だからね。
* CI/CDをうまく回せるようにする（直近の目標）
* PHPunit　でちゃんとする（= 非標準なテストコード書いてたら大変）
* PSR0/PSR4 で清書し直す（遠い目）
* 一般的なフレームワークに落とす（👼）

## モードのこと

* ”Plan": Agentにして何もわからないまま「これ作って」→「これって何」の繰り返しでは、手綱がないまま暴走してしまうことがある。
* "Ask":  ドキュメントも前任者もいないコードだけならリバース・エンジニアリングが基本。おかしなコードを見つけても意図がわかんないんだから「膨大なコード蓄積」からパターンを見つけて何をしてるか解釈してもらうのはあり。
* "Agent": 使い始めるとAgentがデフォルトなのでPoCを用意しないとPythonで書いてくれちゃうことが普通。最近ではPoCは書いてから「ダメ出し」してもらうから、Pythonでゴリゴリ来ることはない。そもそもPythonってそんなにAgentが得意な言語でもなさそう。

## プロンプトをプロンプトで作る

* コードの言語化が不得意ならそこから頼まなくてはならない。
* 抽象化から具体的コードの落とし込みについてプロンプトを通じて処理見張るのが人間の主な仕事。
* 生成AIさんに「欲しい物」を先に示しておかないと、すごい遠回りしてほしいものは手に入れられないことが多い。試験問題と回答を両方示して「答え合わせ」がないと独創してしまう（わりと手を広げてくると収束が大変）。

## 言語モデル別の癖を知る

<b>チャット中にモデルを変えるのはコンテキスト解釈する時間をかなり無駄にするのでやめよう。</b>

* GPT4 :　ちょっと前のモデル 近視眼的な「その場の処理」で辻褄が合う話はちゃんとできる？　ほとんど使ってない。去年の春先までは使ってた。
* GPT5-mini: イラチなのか、エージェントモードにすると「選択肢」出してきて「さっさと選べやこの野郎」的になってきたのでこまる。内部で英語。日本語は気が向いたら的な感じで。
* Anthropic Claude Opus4.5/4.6 : 有料で使える選択肢。　優秀なので「雑な日本語」を理解して、流暢な日本語で返してくれる。ただしトークンあたり倍率3倍なので常用していると月次の限界がわりと来る。
* Gemini 3.0 Pro(preview) : お試しに使ってみたら、結構サクサク行くんだけど、あるところから変なループしてabendさせてしまった。Preview怖い。

Plan/Ask は Claude Opus でじっくり。　コード化はGPT5.1-codeとかがいいのかも。

## 真面目なような真面目でないような技術でない話

* "繰り返し"  :  同じ prompt を投げてやると蓄積されてもので改善が進む
* 毎回忘れる  : Mindfullness の精神。　チャット内容が消えたら「０から」スタートするが、案外それが正しい場合もある（回りくどい手段に執着されると収束しない）
* 毎回記録する : chat をテキスト化して保存→ prompt に混ぜるか作業リポジトリに入れるとモデルと指示に依って「全部読んできて前よりはそこそこ賢くなって」作業に入れる。
* 諦めない  : モデルが日々進化しているし、使う側も知恵がついてくるので、複雑な作業もうまくこなせるようになる。
* 勉強は必要 :　モデルが知ってる「やり方」が古い場合もあるので、先んじてダメ出しをしておかねばならない。　ユーザの知識レベルが低いと得られるそれは酷いものである。


以上
